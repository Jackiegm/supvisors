<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/style.css" />
    <title>Supervisors: A Control System for Distributed Applications</title>
</head>

<body>
	<div id="body_block">

		<div id="left_side">
			<header>
				<h1><a href="#github">Supervisors</a></h1>
				<p class="version">0.1</p>
			</header>

			<nav>
				<ul>
	 				<li><a href="index.html">Introduction</a></li>
               <li><a href="configuration.html" class="active">Configuration</a><ul>
               	<li><a href="#supervisor-config">Supervisor Configuration</a><ul>
               		<li><a href="#supervisor-ext">Extension points</a></li>
               		<li><a href="#supervisors-section">Supervisors section</a></li>
               	</ul></li>
               	<li><a href="#deployment-file">Deployment File</a></li>
               </ul></li>
               <li><a href="xml-rpc-api.html">XML-RPC API Documentation</a></li>
               <li><a href="design.html">Software Design</a></li>
             </ul>
			</nav>

			<footer>
				<p>Contact: <a href="mailto:julien.6387.dev@gmail.com">Julien Le Cléach</a></p>
				<p id="copyright">&copy; Copyright 2016 Julien LE CLEACH</p>
			</footer>
		</div>

		<div id="right_side">
			<header>
				<h1>Supervisors Documentation - Configuration</h1>
			</header>

			<section>
				<h1 id="supervisor-config">Supervisor Configuration</h1>
				<p>This section explains how Supervisors uses and complements the <a href="http://supervisord.org/configuration.html" class="extLink">Supervisor configuration</a>.</p>

				<h2 id="supervisor-ext">Extension points</h2>
				<p>Supervisors extends the <a href="http://supervisord.org/xmlrpc.html" class="extLink">Supervisor’s XML-RPC API</a></p>
				<pre><code lang="ini">[rpcinterface:supervisors]
supervisor.rpcinterface_factory = supervisors.rpcinterface:make_supervisors_rpcinterface</code></pre>
				<p>Supervisors extends also <a href="http://supervisord.org/running.html#running-supervisorctl" class="extLink">supervisorctl</a>. This possibility is not documented in Supervisor.</p>
				<pre><code lang="ini">[ctlplugin:supervisors]
supervisor.ctl_factory = supervisors.supervisorsctl:make_supervisors_controller_plugin</code></pre>

				<h2 id="supervisors-section">Supervisors section</h2>
				<p>Supervisors uses an additional section <code lang="ini">[supervisors]</code> in the Supervisor configuration file file.</p>
				<table class="optionTable">
					<caption>Supervisors options</caption>
					<thead>
						<tr><th>option</th><th>required</th><th>default</th><th>description</th></tr>
					</thead>
					<tbody>
						<tr>
							<td><span class="option">addresslist</span></td>
							<td>yes</td>
							<td></td>
							<td>list of host names or IP addresses where supervisors will be running</td>
						</tr>
						<tr>
							<td><span class="option">deployment_file</span></td>
							<td>no</td>
							<td></td>
							<td>absolute or relative path of the XML deployment file</td>
						</tr>
						<tr>
							<td><span class="option">auto_fencing</span></td>
							<td>no</td>
							<td>false</td>
							<td>when true, Supervisors won't try to reconnect to an address that is not active anymore.
							TODO: explain more</td>
						</tr>
						<tr>
							<td><span class="option">internalport</span></td>
							<td>no</td>
							<td>65001</td>
							<td>port number used to publish local events to remote Supervisors instances</td>
						</tr>
						<tr>
							<td><span class="option">eventport</span></td>
							<td>no</td>
							<td>65002</td>
							<td>port number used to publish all Supervisors events (PROCESS + APPLICATION + HOST). <span class="not-implemented-yet"></span></td>
						</tr>
						<tr>
							<td><span class="option">synchro_timeout</span></td>
							<td>no</td>
							<td>TBD</td>
							<td>time in seconds that Supervisors waits for all expected addresses to publish</td>
						</tr>
						<tr>
							<td><span class="option">deployment_strategy</span></td>
							<td>no</td>
							<td>CONFIG</td>
							<td>strategy used to start applications on addresses. values in { <code>CONFIG</code>, <code>LESS_LOADED</code>, <code>MOST_LOADED</code> } <a href="design.html#deployment" class="intLink">details</a></td>
						</tr>
						<tr>
							<td><span class="option">conciliation_strategy</span></td>
							<td>no</td>
							<td>USER</td>
							<td>strategy used to TBD. values in { <code>SENICIDE</code>, <code>INFANTICIDE</code>, <code>USER</code>, <code>RESTART</code> } <a href="design.html#conciliation" class="intLink">details</a></td>
						</tr>
						<tr>
							<td colspan="4" class="tableInfo">Logging options, identical to <a href="http://supervisord.org/configuration.html#supervisord-section-values" class="extLink">Supervisor's</a></td>
						</tr>
						<tr>
							<td><span class="option">logfile</span></td>
							<td>no</td>
							<td>supervisors.log</td>
							<td>absolute or relative path of the Supervisors log file</td>
						</tr>
						<tr>
							<td><span class="option">logfile_maxbytes</span></td>
							<td>no</td>
							<td>50MB</td>
							<td>maximum size of the Supervisors log file</td>
						</tr>
						<tr>
							<td><span class="option">logfile_backups</span></td>
							<td>no</td>
							<td>10</td>
							<td>number of Supervisors backup log files</td>
						</tr>
						<tr>
							<td><span class="option">loglevel</span></td>
							<td>no</td>
							<td>info</td>
							<td>logging level</td>
						</tr>
					</tbody>
				</table>

				<h1 id="deployment-file">Deployment File</h1>
				<p>Basically, the deployment file contains rules that define how applicative processes should be started. It relies on the Supervisor group and program definitions.<br />
				TODO</p>

				<p>Definition of a program, pattern or model:</p>
				<ul>
					<li><span class="option">addresses</span>: list of host names or IP addresses. must be a subset of <a href="#supervisors-section" class="intLink">addresslist</a>.<br />
					'*': stands for all values in <a href="#supervisors-section" class="intLink">addresslist</a>.<br />
					'#': <span class="not-implemented-yet"></span>only applicable to a pattern. intended to a program that is meant to be started on each address in the address list. In the program configuration file, it is expected that:<ol>
						<li>the <code lang="ini">numprocs</code> value corresponds to the number of elements in <a href="#supervisors-section" class="intLink">addresslist</a>.</li>
						<li>the <code lang="ini">numprocs_start</code> value is 0 (default value).</li></ol>
					<li><span class="option">required</span>: importance of the program for the application. if true (resp. false), program is required (resp. optional).<br />
					if true, direct impact on application state. major failure when stopped or crashed.<br />
					if false (default value), impact only on application degraded status.</li>
					<li><span class="option">sequence</span>: order in application starting.<br />
					if set to -1, process is not automatically started.<br />
					when >= 0, start process automatically in the order specified.</li>
					<li><span class="option">wait_exit</span>: if true, Supervisors waits for the process to exit before deploying the next sequence</li>
					<li><span class="option">loading</span>: expected percent usage of resources</li>
				</ul>

				<p>Definition of a referenced program or pattern:</p>
				<ul>
					<li>reference: name of the applicable model</li>
				</ul>

				<pre><code lang="xml">&lt;program name="firefox"&gt;
	&lt;reference&gt;model_1&lt;/reference&gt;
&lt;/program&gt;</code></pre>

				<p>Definition of an application:</p>
				<ul>
					<li><span class="option">sequence</span>: <span class="not-implemented-yet"></span>defines the automatic start of the application when Supervisors enters in RUNNING state.<br />
					if set to -1, application is not automatically started.<br />
					when >= 0, start application automatically in the order specified.</li>
					<li><span class="option">starting_failure_strategy</span>: <span class="not-implemented-yet"></span><ul>
						<li>ABORT: abort sequence upon major failure.</li>
						<li>CONTINUE: default value. continue sequence upon major failure.</li></ul>
					<li><span class="option">running_failure_strategy</span>: <span class="not-implemented-yet"></span><ul>
						<li>CONTINUE: default value. no action.</li>
						<li>STOP: stop application upon major failure.</li>
						<li>RESTART: only when application is started. restart application upon major failure.</li></ul>
				</ul>

				<p>The XSD contents used to validate the XML can be found in the following module: <code lang="python">supervisors.parser</code>.</p>
			</section>

		</div>
	</div>
</body>
</html>

